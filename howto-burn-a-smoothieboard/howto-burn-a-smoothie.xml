<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE article PUBLIC "-//OASIS//DTD DocBook XML V4.5//EN" "../docbook-xml-4.5/docbookx.dtd">

<article>

  <info>
    <title>How to burn a Smoothieboard</title>

    <author>
      <personname>
        <firstname>Li</firstname>
        <surname>Loong</surname>
      </personname>

      <affiliation>
    <address>
      <email>atommann@gmail.com</email>
    </address>
      </affiliation>
    </author>

    <copyright>
      <year>2016</year>
      <holder>OpenTrons Labworks Inc</holder>
    </copyright>

    <abstract>
      <para>How to reproduce the issue. Note that this write-up is quick and dirty. And my conclusion may be wrong. And also ignore my English syntax and the grammer :)</para>
    </abstract>
  </info>



  <sect1>
    <title>Experiment on July 19 2016</title>

   <para>Chiu mentioned that if drive the axes by hand fast enough, then turn the power on, sometimes the stepper motor driver IC will smoke.</para>

   <para>A motor is also a generator. When you drive the axis the motor will generate a voltage. But how high the voltage is?</para>

    <para>So I connected X, Y and Z cables to the smoothieboard, and used a multimeter to probe the VBB pins of the IC (A4982), at the same time, another person (Jason to be precise) drove the axis by hand.</para>

    <para>Generally when we do this, we can see the VBB LED lights up on the PCB. Jason said: "when I drive this axis I feel it's not smooth..."</para>

    <para>I didn't keep it in mind.</para>

 </sect1>


  <sect1>
    <title>Holy Shit, It really smoked!</title>

    <para>This morning (July 20 2016). I removed the smoothieboard off from the machine which was tested yesterday afternoon. And put it on my desk. Connect the USB cable. It was strange: The 3.3V LED on the boards is not on.</para>

    <para>I did not thinked then (my brain was short-circuited). Then connected the 12VDC, turn the power switch on. It just smoked! I did it! Finally.</para>

    <para>It is the IC for M2.</para>

    <para>Then I connected the motor to M1 and turn the power on, I saw fire on the IC for M2!</para>

    <para>Then I observed the dead IC under an optical microscope. And it is very clear that the VBB1 and VBB2 pins (both are connected with 12V) are burned out (metal pad melted inside the IC), this indicates high current at very very short time! A short circuit can do this.</para>

    <para>Removed the IC for M2 and removed the motor.</para>

    <para>Connect USB cable again, the 3.3V LED on the board is dim. Check the voltage of 3.3V, the reading is only ~1.8V. The LM1117-3.3 is super hot. The MCU is super hot.</para>


<figure><title>VBB fused</title>
<mediaobject>
  <imageobject>
    <imagedata fileref="figures/burnt.jpg"/>
  </imageobject>
  <textobject><phrase>VBB fused</phrase></textobject>
</mediaobject>
</figure>

 </sect1>

 <sect1>
    <title>There's a Short-circuit</title>

    <para>Then I measured 3.3V and GND with a multimeter on the PCB and found that they are shorted! But where? Need to find it out.</para>

    <para>So I start to remove ICs one by one. After I removed one IC, I used the multimeter to check 3.3V and GND to see if the PCB still has short-circuit.</para>

    <para>After removed all stepper motor driver ICs, the short-circuit still exist.</para>

    <para>Then removed the MCU (LPC1769FBD100,551), short-circuit disappeared suddenly!</para>

    <para>Double check Vdd (eg. pin 96) and Vss (eg. pin 97) pin of the MCU, yes, they are shorted internally. It means this MCU is already dead.</para>

<figure><title>Seeking the short-circuit</title>
<mediaobject>
  <imageobject>
    <imagedata fileref="figures/short-circuit.jpg"/>
  </imageobject>
  <textobject><phrase>short circuit</phrase></textobject>
</mediaobject>
</figure>

 <sect1>
    <title>Reproduce it Again</title>

    <para>Which caused the short-circuit? I am curious. Yesterday we did nothing special but just drove the axes by hand.</para>

    <para>I talked this problem with Kenny Tay, he is also an EE. We changed some ideas. And I said: "See if I can reproduce it again."</para>


    <para>Then I connect the only blue smoothieboard with the machine, drive the axis by hand. The VBB LED lights up. Drive it for a little bit longer. Suddenly the VBB LED is off.</para>

    <para>Stop the driving.</para>

    <para>Check 3.3V and GND. I get short-circuit!</para>

    <para>Check VBB(12V) and GND. The multimeter beeps, the resistance is only about 13 Ohm! Which can be considered as a short-circuit!</para>

    <para>And at this moment, with the motor cable connected (for example X axis), if you still drive the axis, you will feel that you need to use more force to drive the axis. This is because 12V and GND has been tied together by the short circuit. So the coil of the motor has been shorted. When a motor's coil is shorted, it is in the "brake" mode. This is what Jason's feeling yesterday (why it's not smooth).</para>

    <para>And if I connect the 12V power supply, I think the ICs will smoke right away. But it's possible to fix the boards or I leave the sparkfun for tomorrow.</para>

    <para>Update: Just have a short talk with Kenny again. He said: "Let's try to see if it smokes."</para>


    <para>OK, let's do it. So we get this video.</para>


    <note>The original video is in folder <filename>figure/video.mov</filename></note>

<figure><title>crazy smoke with fire</title>
<mediaobject>
  <imageobject>
    <imagedata fileref="figures/video.gif"/>
  </imageobject>
  <textobject><phrase>smoke with fire</phrase></textobject>
</mediaobject>
</figure>


  <para>But how exactly the electrons loos in the stepper motor driver IC? And what happened?</para>


<figure><title>why not smooth</title>
<mediaobject>
  <imageobject>
    <imagedata fileref="figures/coil-short.png"/>
  </imageobject>
  <textobject><phrase>coil shorted</phrase></textobject>
</mediaobject>
</figure>



  </sect1>


  </sect1>

 <sect1>
    <title>Why M4 and M5 never smoked</title>

<itemizedlist>
<listitem>
    <para>Generally the travel distance of A and B motors are short.</para>
</listitem>
<listitem>
    <para>Generally it's not easy to drive A and B by hand.</para>
</listitem>

</itemizedlist>



  </sect1>

 <sect1>
    <title>Why Almost only OpenTrons faces this issue</title>

<itemizedlist>
<listitem>
    <para>Our mechanism is kinda special. Like used belt.</para>
</listitem>
<listitem>
    <para>The machine itself is relatively big.</para>
</listitem>
<listitem>
    <para><personname>Will</personname> also mentioned that sometime after the customer relocated the machine, it smoked. The reason is that the shaking killed the circuit board.</para>
</listitem>
<listitem>
    <para><personname>Chiu</personname> mentioned that after some customer just got the machine, powered it on, it smoked. The reason is that the circuit has been killed during the shipment by shaking.</para>
</listitem>
<listitem>
    <para>Other machines which uses smoothieboard may use lead-screw to drive the load which is not easy to shake and move.</para>
</listitem>

</itemizedlist>



  </sect1>

 <sect1>
    <title>Conclusion</title>

    <para>The movement of the axes(motors) generate relative high voltage wich killed the circuit, caused the short-circuits. When turn the power on, high current fried the IC. Released the "magic smoke". So the PCB ceases to work.</para>

  </sect1>

 <sect1>
    <title>How to Get Rid of This Issue</title>

    <para>Now I don't know.</para>

    <para>It is possible to use an oscilloscope or other instruments to capture the Electromotive Force induced by the stepper motors.</para>

  </sect1>


</article>

